<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Clear All Data - BTB Fit</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .warning-box {
      background: #ff6b6b;
      border: 3px solid #ff3838;
      padding: 24px;
      border-radius: 8px;
      margin: 24px auto;
      max-width: 600px;
      text-align: center;
    }
    .warning-box h1 {
      color: white;
      margin-bottom: 16px;
      font-size: 32px;
    }
    .warning-box p {
      color: white;
      font-size: 16px;
      line-height: 1.6;
      margin-bottom: 24px;
    }
    .btn-danger {
      background: #2e3440;
      color: white;
      padding: 16px 32px;
      border: 2px solid white;
      border-radius: 6px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      margin: 8px;
    }
    .btn-danger:hover {
      background: #1a1f29;
    }
    .btn-safe {
      background: #34e27c;
      color: #1a2332;
      padding: 16px 32px;
      border: none;
      border-radius: 6px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      margin: 8px;
    }
    .status {
      margin-top: 24px;
      padding: 16px;
      border-radius: 6px;
      display: none;
    }
    .status.success {
      background: #34e27c;
      color: #1a2332;
    }
    .status.error {
      background: #ff6b6b;
      color: white;
    }
  </style>
</head>
<body>
  <div class="warning-box">
    <h1>‚ö†Ô∏è DANGER ZONE ‚ö†Ô∏è</h1>
    <p><strong>This will permanently delete ALL data:</strong></p>
    <ul style="text-align: left; margin: 0 auto; max-width: 400px; color: white;">
      <li>All baseline stats (age, height, weight, body composition)</li>
      <li>All workout entries</li>
      <li>All nutrition logs</li>
      <li>All hydration tracking</li>
      <li>Display name and privacy settings</li>
      <li>Data from browser (localStorage)</li>
      <li>Data from database (PostgreSQL)</li>
    </ul>
    <p style="margin-top: 24px; font-weight: bold; font-size: 18px;">
      THIS CANNOT BE UNDONE!
    </p>
    
    <div style="margin-top: 32px;">
      <button class="btn-danger" onclick="clearAllData()">
        üóëÔ∏è DELETE EVERYTHING
      </button>
      <br>
      <button class="btn-safe" onclick="window.location.href='admin.html'">
        ‚Üê Cancel, Go Back to Safety
      </button>
    </div>
    
    <div id="status" class="status"></div>
  </div>

  <script>
    const ADMIN_USER = 'btbga';

    async function clearAllData() {
      const confirm1 = confirm('Are you ABSOLUTELY SURE you want to delete EVERYTHING?');
      if (!confirm1) return;
      
      const confirm2 = confirm('This is your FINAL WARNING. All data will be permanently deleted. Continue?');
      if (!confirm2) return;

      const status = document.getElementById('status');
      status.style.display = 'block';
      status.className = 'status';
      status.textContent = 'Deleting data...';

      try {
        // Clear localStorage
        const keys = Object.keys(localStorage);
        const btbKeys = keys.filter(k => k.startsWith('btb_'));
        
        btbKeys.forEach(key => {
          localStorage.removeItem(key);
          console.log('Removed:', key);
        });

        // Clear from database
        const dataTypes = ['baseline', 'entries', 'profile', 'privacy'];
        
        for (const dataType of dataTypes) {
          try {
            const response = await fetch('/api/save-data', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                token: 'authenticated',
                dataType: dataType,
                data: null
              })
            });
            
            if (response.ok) {
              console.log(`Cleared ${dataType} from database`);
            }
          } catch (err) {
            console.error(`Error clearing ${dataType}:`, err);
          }
        }

        // Success
        status.className = 'status success';
        status.innerHTML = `
          <strong>‚úÖ ALL DATA DELETED</strong><br>
          localStorage cleared: ${btbKeys.length} items<br>
          Database cleared: ${dataTypes.length} tables<br><br>
          <a href="admin.html" style="color: #1a2332; text-decoration: underline; font-weight: bold;">
            Start Fresh ‚Üí
          </a>
        `;

      } catch (error) {
        console.error('Clear error:', error);
        status.className = 'status error';
        status.innerHTML = `
          <strong>‚ùå ERROR</strong><br>
          ${error.message}<br>
          Some data may not have been deleted. Check console for details.
        `;
      }
    }
  </script>
</body>
</html>
